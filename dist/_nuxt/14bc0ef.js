(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{489:function(e,r,t){"use strict";t.r(r);var n=t(3),o=(t(18),t(44),{data:function(){return{form:{email:"",password:""},rules:{email:[{required:!0,message:"Please enter you email address",trigger:"blur"},{type:"email",message:"Please enter a valid email address",trigger:"blur"}],password:[{required:!0,message:"Please enter your password",trigger:"blur"}]}}},methods:{handleLogin:function(e){var r=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),t.prev=1,t.next=4,r.$auth.loginWith("backend",{data:{email:r.form.email,password:r.form.password}}).then((function(e){console.log(e),r.$axios.setHeader("Authorization",e.data.access_token),r.$auth.setUserToken(e.data.access_token).then((function(e){console.log(r.$auth.user),r.$router.push("".concat(1===r.$auth.user.user_role_id?"/admin/dashboard":"/message")),r.$message({showClose:!0,message:"Welcome back ".concat(r.$auth.user.name,"."),type:"success"}),r.handle().updateFirebase()})),console.log(r.$auth.loggedIn)}));case 4:t.next=10;break;case 6:t.prev=6,t.t0=t.catch(1),r.$cg({title:"Login Error",type:"error",logs:t.t0}),r.$message({message:"Your email or password is incorrect",type:"error"});case 10:case"end":return t.stop()}}),t,null,[[1,6]])})))()},handle:function(){var e=this;return{updateFirebase:function(){return Object(n.a)(regeneratorRuntime.mark((function r(){var t;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.$fire.messaging.deleteToken();case 2:if(r.sent){r.next=5;break}return r.abrupt("return");case 5:return r.next=7,e.$fire.messaging.getToken();case 7:return t=r.sent,console.group("Firebase Token"),console.log(t),console.groupEnd(),r.next=13,e.$sender({method:"put",url:"user/".concat(e.$auth.user.id,"/update/firebase_token"),data:{firebase_token:t}}).then((function(r){e.firebase().startOnMessageListener()}));case 13:case"end":return r.stop()}}),r)})))()}}},firebase:function(){var e=this;return{startOnMessageListener:function(){e.$fire.messaging.onMessage((function(r){e.$notify({title:r.notification.title,message:r.notification.body})}))},deleteToken:function(){return Object(n.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.$fire.messaging.deleteToken();case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))()}}}}}),l=t(11),component=Object(l.a)(o,(function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px","label-position":"top",inline:!1,size:"medium"}},[t("el-form-item",{attrs:{label:"",prop:"email"}},[t("el-input",{attrs:{placeholder:"Your Email"},model:{value:e.form.email,callback:function(r){e.$set(e.form,"email",r)},expression:"form.email"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"",prop:"password"}},[t("el-input",{attrs:{placeholder:"Your Password","show-password":""},model:{value:e.form.password,callback:function(r){e.$set(e.form,"password",r)},expression:"form.password"}})],1),e._v(" "),t("el-form-item",{staticStyle:{"text-align":"center"}},[t("el-button",{attrs:{type:"primary"},on:{click:e.handleLogin}},[e._v("\n      Login\n    ")])],1)],1)}),[],!1,null,null,null);r.default=component.exports}}]);