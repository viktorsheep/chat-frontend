(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{467:function(e,t,r){var content=r(478);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(36).default)("2eead585",content,!0,{sourceMap:!1})},477:function(e,t,r){"use strict";r(467)},478:function(e,t,r){var n=r(35)(!1);n.push([e.i,".wrap-rejoin[data-v-4e01fc04]{background:#d8edff;height:50px;line-height:50px;margin-top:-91px;margin-bottom:40px;padding:0 20px;text-align:center;color:#777;border:1px solid #1f91f2;border-radius:8px}.wrap-messages[data-v-4e01fc04]{height:calc(100vh - 134px);margin-top:-20px;margin-right:-20px;margin-left:-20px;padding:10px 10px 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;overflow-y:auto;display:flex;flex-direction:column-reverse}.wrap-messages .message[data-v-4e01fc04]{margin-bottom:10px}.wrap-messages .message .text[data-v-4e01fc04]{background:#eee;color:#999;position:relative;border-radius:14px 14px 14px 14px;padding:10px;transition:all .2s ease-in-out;margin-bottom:25px}.wrap-messages .message .text .time[data-v-4e01fc04]{width:200px;height:25px;line-height:25px;position:absolute;bottom:-25px;font-size:12px;color:#ddd;display:block}.wrap-messages .message .text .time[data-v-4e01fc04]:hover{color:#999}.wrap-messages .message:hover .text[data-v-4e01fc04]{opacity:.8}.wrap-messages .message .time[data-v-4e01fc04]{transition:all .2s ease-in-out}.wrap-messages .message.sent.sending .text[data-v-4e01fc04]{opacity:.6}.wrap-messages .message.sent .text[data-v-4e01fc04]{float:right;background:#1f91f2;color:#fff;margin-bottom:40px}.wrap-messages .message.sent .text .time[data-v-4e01fc04]{right:0;text-align:right}.wrap-messages .message.sent:hover .text .time[data-v-4e01fc04]{color:#999}.wrap-messages .message.received .text[data-v-4e01fc04]{float:left;color:#777}.wrap-messages .message.received .text .time[data-v-4e01fc04]{left:0;text-align:left}.wrap-control[data-v-4e01fc04]{height:63px;line-height:63px;padding:0 10px;background:#eee;overflow:hidden;margin-bottom:-20px;margin-left:-20px;margin-right:-20px}.wrap-recorder[data-v-4e01fc04]{text-align:center}.wrap-recorder .time[data-v-4e01fc04]{font-size:18px;color:#999;height:50px;line-height:50px}",""]),e.exports=n},486:function(e,t,r){"use strict";r.r(t);r(26),r(18),r(25),r(37),r(38);var n=r(3),o=r(12),c=(r(16),r(199),r(9),r(55),r(44),r(101),r(27),r(29),r(475),r(281),r(19),r(43)),l=r(79);function d(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function m(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?d(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):d(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var h={layout:"app",data:function(){return{message:"",selectedPage:null,msgControl:{empty:!0},disabled:{btnJoin:!1},loading:{wrap:!0,messages:!1},visibility:{controls:!1,recorder:!1},sending:{text:"",status:!1},fbmessages:[],timer:{time:"01:00",status:!1,interval:"01:00"},recorder:{fn:"",is:{initiated:!1,recording:!1,waitingToRecord:!1,cancelled:!1},blob:"",visual:[],hasBlob:!1,chunks:[],player:{controls:!1,src:""}}}},fetch:function(){void 0!==this.$route.query.page&&this.getMessages(this.$route.query.page)},computed:m(m({},Object(c.c)({messages:"messages/messages",messageAll:"messages/messageAll",pages:"pages/pages"})),{},{currentPage:function(){var e=this,t={};return void 0!==this.$route.query.page&&(t=m({},this.pages.find((function(p){return p.id===parseInt(e.$route.query.page)})))),t}}),watch:{"$route.query":function(e,t){void 0!==e.page?(this.setPageOn(e.page),void 0!==e.mid?(this.getFBMessage(),void 0===e.psid&&(this.visibility.controls=!1)):(this.fbmessages=[],this.visibility.controls=!1)):this.selectedPage=null},message:function(e,t){this.msgControl.empty=""===e},recorder:{handler:function(e,t){console.log("watch "),""!==this.recorder.blob?this.recorder.hasBlob=!0:this.recorder.hasBlob=!1,e.is.initiated&&e.is.waitingToRecord&&this.startRecording(),console.log(this.recorder.blob)},deep:!0}},mounted:function(){void 0!==this.$route.query.page?(this.setPageOn(this.$route.query.page),void 0!==this.$route.query.mid?(this.getFBMessage(),void 0===this.$route.query.psid&&(this.visibility.controls=!1)):(this.fbmessages=[],this.visibility.controls=!1)):(this.selectedPage=null,this.loading.wrap=!1)},methods:m(m({},Object(c.b)({getMessages:"messages/browse"})),{},{sendMessage:function(){var e=arguments,t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n,o,c,p;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.length>0&&void 0!==e[0]?e[0]:"text",void 0===t.$route.query.psid){r.next=19;break}if(console.log(n),o=t.message+"",t.message="",t.sending={status:!0,text:"text"===n?o:"Voice Message."},c="text"===n?{recipient:{id:t.$route.query.psid},message:{}}:new FormData,"text"!==n){r.next=13;break}return c.message.text="text"===n?o:"Voice Message.",r.next=11,l.api("/me/messages?access_token=".concat(t.currentPage.access_token),"post",c).then((function(e){t.resetRecorder(!0),t.getFBMessage(!0)})).catch((function(e){t.$notify.error({title:"Sorry, something went wrong.",message:"There was an error while sending the message. Please try again later."}),t.$cg({type:"error",title:"Facebook Send Message Error",logs:e})}));case 11:r.next=19;break;case 13:return c.append("recipient",JSON.stringify({id:t.$route.query.psid})),c.append("message",JSON.stringify({attachment:{type:"audio",payload:{is_reusable:!0}}})),c.append("filedata",t.recorder.blob),p={method:"post",url:"/me/messages?access_token=".concat(t.currentPage.access_token),baseURL:"https://graph.facebook.com/v14.0",data:c,headers:{contentType:"formData"}},r.next=19,t.$sender(p).then((function(e){t.resetRecorder(!0),t.getFBMessage(!0)}));case 19:case"end":return r.stop()}}),r)})))()},setPageOn:function(e){this.checkIfPageExists(e)},checkIfPageExists:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.loading.wrap=!0,n={method:"get",url:"user/page/exists/".concat(e)},r.next=4,t.$sender(n).then((function(e){t.selectedPage=e.content.data,t.loading.wrap=!1}));case 4:case"end":return r.stop()}}),r)})))()},handleJoinClick:function(){this.initAddEdit("add")},handleRejoinClick:function(){this.initAddEdit("edit")},initAddEdit:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n,o,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.$route.query.page,o={method:"add"===e?"post":"put",url:"user/page/".concat(e,"/").concat(n)},"edit"===e&&(o.message={success:"You rejoined chat to this page."}),r.next=5,t.$sender(o).then((function(e){console.log(e),t.selectedPage="Exits.",t.$root.$emit("PageJoined",e.content.data)}));case 5:return c=r.sent,r.abrupt("return",c);case 7:case"end":return r.stop()}}),r)})))()},getFBMessage:function(){var e=arguments,t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.length>0&&void 0!==e[0]&&e[0]||(t.fbmessages=[],t.visibility.controls=!1),r.next=4,l.api("/".concat(t.$route.query.mid,"/messages"),"get",{fields:"created_time,id,message,from,to,tags",access_token:t.currentPage.access_token}).then((function(e){t.fbmessages=e.data,t.visibility.controls=!0,t.sending={status:!1,text:""}})).catch((function(e){t.$notify.error({title:"Sorry, something went wrong.",message:"There was an error while getting the messages. Please try again later."}),t.$cg({type:"error",title:"Facebook Send Message Error",logs:e})}));case 4:case"end":return r.stop()}}),r)})))()},isSent:function(e){return void 0!==e.data.find((function(e){return"sent"===e.name}))},parseDate:function(e){var t=new Date(e);return{fullDate:this.$moment(e).format("D MMM YY hh:mm A"),date:this.$moment(t.getTime()).fromNow()}},handleStartTimer:function(){var e=this;this.timer.interval=setInterval((function(){0===e.timer.time?(e.stopRecording(),e.handleStopTimer(),e.resetTimer()):(e.timer.status=!0,"01:00"===e.timer.time&&(e.timer.time=10),console.log(e.timer.time--))}),1e3)},handleStopTimer:function(){this.timer.status=!1,clearInterval(this.timer.interval)},handleRecorderCancel:function(){this.stopRecording(!0)},resetTimer:function(){this.timer.time="01:00",this.timer.status=!1},initRecorder:function(){var e=this;navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){e.recorder.fn=new MediaRecorder(t),e.recorder.is.initiated=!0,e.recorder.fn.ondataavailable=function(t){if(e.recorder.chunks.push(t.data),"inactive"===e.recorder.fn.state){var r=new Blob(e.recorder.chunks,{type:"audio/wav"});e.recorder.player.src=URL.createObjectURL(r),e.recorder.player.controls=!0,e.recorder.is.cancelled||(e.recorder.blob=r),e.recorder.is.cancelled=!1}},e.recorder.fn.onstop=function(r){t.getTracks().forEach((function(track){track.stop()})),e.resetRecorder()}}))},initRecording:function(){this.recorder.is.initiated?this.startRecording():(this.recorder.is.waitingToRecord=!0,this.initRecorder())},startRecording:function(){this.recorder.chunks=[],this.recorder.fn.start(),this.handleStartTimer(),this.recorder.is.waitingToRecord=!1},stopRecording:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&(this.recorder.is.cancelled=!0),this.recorder.fn.stop(),this.handleStopTimer()},resetRecorder:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.resetTimer(),this.recorder.is.initiated=!1,e&&(this.recorder.blob="")},handlePopOverAfterLeave:function(){this.resetRecorder(!0)},uploadBlob:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=new FormData).append("file",e.recorder.blob),n={method:"post",url:"file/upload",headers:{contentType:"formData"},data:r},console.log(e.recorder.blob),t.next=6,e.$sender(n);case 6:o=t.sent,console.log(o);case 8:case"end":return t.stop()}}),t)})))()},deleteBlob:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$sender({method:"delete",url:"file/delete"});case 2:r=t.sent,console.log(r);case 4:case"end":return t.stop()}}),t)})))()}})},f=h,v=(r(477),r(10)),component=Object(v.a)(f,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.wrap,expression:"loading.wrap"}],attrs:{"element-loading-text":"Retrieving Information..."}},[null===e.selectedPage?r("el-empty",{attrs:{description:"Select one of the page at the right side to get started."}}):"Does not exists."===e.selectedPage?r("el-empty",{attrs:{description:"You are not joined to this page. Join now to send prayers."}},[r("el-button",{attrs:{type:"primary",size:"mini",disabled:e.disabled.btnJoin},on:{click:e.handleJoinClick}},[e._v("\n      Join\n    ")])],1):r("div",{staticStyle:{background:"white"}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:!e.visibility.controls&&void 0!==e.$route.query.psid,expression:"!visibility.controls && $route.query.psid !== undefined"}],staticClass:"wrap-messages",attrs:{"element-loading-text":"Getting Messages"}},[e.sending.status?r("div",{staticClass:"message sent sending"},[r("div",{staticClass:"text"},[r("i",{staticClass:"el-icon-loading"}),e._v("\n          "+e._s(e.sending.text)+"\n\n          "),r("div",{staticClass:"time"})])]):e._e(),e._v(" "),e._l(e.fbmessages,(function(t){return r("div",{key:t.id,class:"message "+(!0===e.isSent(t.tags)?"sent":"received")},[r("div",{staticClass:"text"},[e._v("\n          "+e._s(t.message)+"\n\n          "),r("div",{staticClass:"time"},[r("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:e.parseDate(t.created_time).fullDate,placement:!0===e.isSent(t.tags)?"left":"right"}},[r("span",[e._v("\n                "+e._s(e.parseDate(t.created_time).date)+"\n              ")])])],1)]),e._v(" "),r("div",{staticStyle:{clear:"both"}})])}))],2),e._v(" "),"Left."===e.selectedPage?r("div",{staticClass:"wrap-rejoin"},[e._v("\n      You left this page chat.\n      "),r("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleRejoinClick}},[e._v("\n        Rejoin Now\n      ")])],1):e._e(),e._v(" "),e.visibility.controls?r("div",{staticClass:"wrap-control"},[r("el-input",{staticStyle:{width:"calc(100% - 50px)"},attrs:{placeholder:"Left."===e.selectedPage?"You cannot send messages because you have left the page. Join again to be able to send messages again.":"Press enter to send ...",size:"small",clearable:"",disabled:"Left."===e.selectedPage},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage.apply(null,arguments)}},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}}),e._v(" "),e.msgControl.empty?r("el-popover",{attrs:{placement:"top",width:"400",trigger:"click",value:e.visibility.recorder},on:{"after-leave":e.handlePopOverAfterLeave}},[r("div",{staticClass:"wrap-recorder"},[e.recorder.hasBlob?e._e():r("div",[r("div",{staticClass:"time"},[e._v("\n              "+e._s(e.timer.time)+"\n            ")]),e._v(" "),r("el-button",{attrs:{icon:e.timer.status?"el-icon-check":"el-icon-microphone",type:e.timer.status?"danger":"primary",circle:""},on:{click:function(t){e.timer.status?e.stopRecording():e.initRecording()}}}),e._v(" "),e.timer.status?r("el-button",{attrs:{icon:"el-icon-close",size:"small",circle:""},on:{click:function(t){return e.handleRecorderCancel()}}}):e._e()],1),e._v(" "),e.recorder.hasBlob?r("div",[r("audio",{attrs:{id:"recordedAudio",controls:e.recorder.player.controls,src:e.recorder.player.src,autoplay:"false"}}),e._v(" "),r("div",{staticStyle:{"margin-top":"10px"}},[r("el-button",{attrs:{icon:"el-icon-s-promotion",type:"primary",circle:""},on:{click:function(t){return e.sendMessage("audio")}}}),e._v(" "),r("el-button",{attrs:{icon:"el-icon-refresh",type:"default",size:"small",circle:""},on:{click:function(t){return e.resetRecorder(!0)}}})],1)]):e._e()]),e._v(" "),r("el-button",{staticStyle:{width:"40px"},attrs:{slot:"reference",type:"text",disabled:"Left."===e.selectedPage},slot:"reference"},[r("i",{staticClass:"el-icon-microphone"})])],1):r("el-button",{staticStyle:{width:"40px"},attrs:{type:"text"},on:{click:function(t){return e.sendMessage("text")}}},[r("i",{staticClass:"el-icon-s-promotion"})])],1):e._e()])],1)}),[],!1,null,"4e01fc04",null);t.default=component.exports}}]);